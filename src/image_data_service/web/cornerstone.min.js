/*! cornerstone - v0.3.0 - 2014-04-19 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */
var cornerstone=function(a){"use strict";function b(){var a=0,b=/MSIE (\d+\.\d+);/.test(navigator.userAgent),c=!!navigator.userAgent.match(/Trident\/7.0/),d=navigator.userAgent.indexOf("rv:11.0");return b&&(a=new Number(RegExp.$1)),-1!=navigator.appVersion.indexOf("MSIE 10")&&(a=10),c&&-1!=d&&(a=11),a}return void 0===a&&(a={}),a.ieVersion=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}function c(a,c,e){if(void 0===a)throw"cornerstoneEvent: parameter enabledElement cannot be undefined";if(void 0===c)throw"cornerstoneEvent: parameter eventName cannot be undefined";void 0===e&&(e={}),e.viewport=a.viewport,e.element=a.element,e.image=a.image,e.enabledElement=a;var f;f=11>=d?new b(c,{detail:e,bubbles:!1,cancelable:!1}):new CustomEvent(c,{detail:e,bubbles:!1,cancelable:!1}),a.element.dispatchEvent(f)}void 0===a&&(a={});var d=a.ieVersion();return b.prototype=window.Event.prototype,a.event=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d){if(void 0===b)throw"displayImage: parameter element cannot be undefined";if(void 0===c)throw"displayImage: parameter image cannot be undefined";var e=a.getEnabledElement(b);if(e.image=c,void 0===e.viewport&&(e.viewport=a.getDefaultViewport(e.canvas,c)),d)for(var f in d)null!==d[f]&&(e.viewport[f]=d[f]);a.updateImage(b),a.event(e,"CornerstoneViewportUpdated");var g,h=new Date;if(void 0!==e.lastImageTimeStamp){var i=h.getTime()-e.lastImageTimeStamp;g=(1e3/i).toFixed()}e.lastImageTimeStamp=h.getTime();var j={frameRate:g};a.event(e,"CornerstoneNewImage",j)}return void 0===a&&(a={}),a.displayImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){m.width=a.width,m.height=a.height,h=m.getContext("2d"),h.fillStyle="white",h.fillRect(0,0,m.width,m.height),i=h.getImageData(0,0,a.width,a.height)}function c(a){n.width=a.width,n.height=a.height,j=n.getContext("2d"),j.fillStyle="white",j.fillRect(0,0,n.width,n.height),k=j.getImageData(0,0,a.width,a.height)}function d(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function e(a,b){return b.imageId!==l||o.windowCenter!==a.viewport.voi.windowCenter||o.windowWidth!==a.viewport.voi.windowWidth||o.invert!==a.viewport.invert?!0:!1}function f(f,g){if(g.color){if(f.viewport.voi.windowWidth===f.image.windowWidth&&f.viewport.voi.windowCenter===f.image.windowCenter&&f.viewport.invert===!1)return g.getCanvas();if(e(f,g)===!1)return n;(n.width!==g.width||n.height!=g.height)&&c(g);var l=d(g,f.viewport);return a.storedColorPixelDataToCanvasImageData(g,l,k.data),j.putImageData(k,0,0),n}if(e(f,g)===!1)return m;(m.width!==g.width||m.height!=g.height)&&b(g);var o=d(g,f.viewport);return a.storedPixelDataToCanvasImageData(g,o,i.data),h.putImageData(i,0,0),m}function g(b){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var c=b.image;if(void 0===c)throw"drawImage: image must be loaded before it can be drawn";var d=new Date,e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),e.save(),a.setToPixelCoordinateSystem(b,e);var g=f(b,c);l=c.imageId,o.windowCenter=b.viewport.voi.windowCenter,o.windowWidth=b.viewport.voi.windowWidth,o.invert=b.viewport.invert,b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),e.drawImage(g,0,0,c.width,c.height,0,0,c.width,c.height),e.restore();var h=new Date,i=h-d,j={canvasContext:e,renderTimeInMs:i};a.event(b,"CornerstoneImageRendered",j)}void 0===a&&(a={});var h,i,j,k,l,m=document.createElement("canvas"),n=document.createElement("canvas"),o={};return a.drawImage=g,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){if(void 0===b)throw"enable: parameter element cannot be undefined";var c=document.createElement("canvas");b.appendChild(c);var d={element:b,canvas:c,image:void 0,data:{}};return a.addEnabledElement(d),a.resize(b,!0),b}return void 0===a&&(a={}),a.enable=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}return void 0===a&&(a={}),a.getElementData=b,a.removeElementData=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<e.length;b++)if(e[b].element==a)return e[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";e.push(a)}function d(a){if(void 0===a)throw"getEnabledElement: element element must not be undefined";for(var b=0;b<e.length;b++)if(e[b].element===a)return e[b].element.removeChild(e[b].canvas),void e.splice(b,1)}void 0===a&&(a={});var e=[];return a.getEnabledElement=b,a.addEnabledElement=c,a.removeEnabledElement=d,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.getDefaultViewport(c.canvas,c.image);c.viewport.scale=d.scale,c.viewport.translation.x=d.translation.x,c.viewport.translation.y=d.translation.y,a.updateImage(b)}return void 0===a&&(a={}),a.fitToWindow=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c,d){void 0===a.lut&&(a.lut=[]);var e,f,g,h,i=a.lut,j=a.maxPixelValue,k=a.slope,l=a.intercept,m=b,n=c;if(d===!0)for(h=a.minPixelValue;j>=h;h++)e=h*k+l,f=255*((e-n)/m+.5),g=Math.min(Math.max(f,0),255),i[h]=Math.round(255-g);else for(h=a.minPixelValue;j>=h;h++)e=h*k+l,f=255*((e-n)/m+.5),g=Math.min(Math.max(f,0),255),i[h]=Math.round(g)}return void 0===a&&(a={}),a.generateLut=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,pixelReplication:!1},d=a.height/b.rows,e=a.width/b.columns;return c.scale=d>e?e:d,c}return void 0===a&&(a={}),a.getDefaultViewport=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;f>k;k++)for(var l=0;e>l;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}return void 0===a&&(a={}),a.getStoredPixels=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";j=a,c()}function c(){function a(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(j>=k))for(i.sort(a);k>j;){var b=i[i.length-1];k-=b.sizeInBytes,delete h[b.imageId],i.pop()}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(h.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={imageId:a,imagePromise:b,timeStamp:new Date,sizeInBytes:0};h[a]=d,i.push(d),b.then(function(a){if(d.loaded=!0,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";d.sizeInBytes=a.sizeInBytes,k+=d.sizeInBytes,c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=h[a];return void 0===b?void 0:(b.timeStamp=new Date,b.imagePromise)}function f(){return{maximumSizeInBytes:j,cacheSizeInBytes:k,numberOfImagesCached:i.length}}function g(){var a=j;j=0,c(),j=a}void 0===a&&(a={});var h={},i=[],j=1073741824,k=0;return a.imageCache={putImagePromise:d,getImagePromise:e,setMaximumSizeBytes:b,getCacheInfo:f,purgeCache:g},a}(cornerstone),cornerstone=function(a){"use strict";function b(a){var b,c=a.indexOf(":"),d=a.substring(0,c),e=g[d];return void 0===e||null===e?void 0!==f?b=f(a):void 0:b=e(a)}function c(c){if(void 0===c)throw"loadImage: parameter imageId must not be undefined";var d=a.imageCache.getImagePromise(c);if(void 0!==d)return d;if(d=b(c),void 0===d)throw"loadImage: no image loader for imageId";return a.imageCache.putImagePromise(c,d),d}function d(a,b){g[a]=b}function e(a){var b=f;return f=a,b}void 0===a&&(a={});var f,g={};return a.loadImage=c,a.registerImageLoader=d,a.registerUnknownImageLoader=e,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=b.getBoundingClientRect(),g=c-f.left-window.scrollX,h=d-f.top-window.scrollY,i=g-f.width/2,j=h-f.height/2,k=e.viewport,l=e.viewport.scale,m=e.viewport.scale;e.image.rowPixelSpacing<e.image.columnPixelSpacing?l*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(m*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);var n=i/l,o=j/m,p=n-k.translation.x,q=o-k.translation.y;return p+=e.image.columns/2,q+=e.image.rows/2,{x:p,y:q}}return void 0===a&&(a={}),a.pageToPixel=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){var c=window.devicePixelRatio;void 0===c&&(c=1),b.width=a.clientWidth*c,b.height=a.clientHeight*c,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px"}function c(c,d){var e=a.getEnabledElement(c);b(c,e.canvas),void 0!==e.image&&(d===!0?a.fitToWindow(c):a.updateImage(c))}return void 0===a&&(a={}),a.resize=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c){if(void 0===a)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===b)throw"setToPixelCoordinateSystem: parameter context must not be undefined";b.setTransform(1,0,0,1,0,0),b.translate(a.canvas.width/2,a.canvas.height/2);var d=a.viewport.scale,e=a.viewport.scale;a.image.rowPixelSpacing<a.image.columnPixelSpacing?d*=a.image.columnPixelSpacing/a.image.rowPixelSpacing:a.image.columnPixelSpacing<a.image.rowPixelSpacing&&(e*=a.image.rowPixelSpacing/a.image.columnPixelSpacing),b.scale(d,e),b.translate(a.viewport.translation.x,a.viewport.translation.y),void 0===c?c=1:b.scale(c,c),b.translate(-a.image.width/2/c,-a.image.height/2/c)}return void 0===a&&(a={}),a.setToPixelCoordinateSystem=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c){for(var d=3,e=0,f=a.width*a.height,g=a.getPixelData(),h=b,i=c;f>e;)i[d]=h[g[e++]],d+=4}function c(a,b,c){for(var d=0,e=0,f=a.width*a.height*4,g=a.getPixelData(),h=b,i=c;f>e;)i[d++]=h[g[e++]],i[d++]=h[g[e++]],i[d]=h[g[e]],e+=2,d+=2}return void 0===a&&(a={}),a.storedPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){var c=a.getEnabledElement(b);if(void 0===c.image)throw"updateImage: image has not been loaded yet";a.drawImage(c)}return void 0===a&&(a={}),a.updateImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);d.viewport.scale=c.scale,d.viewport.translation.x=c.translation.x,d.viewport.translation.y=c.translation.y,d.viewport.voi.windowWidth=c.voi.windowWidth,d.viewport.voi.windowCenter=c.voi.windowCenter,d.viewport.invert=c.invert,d.viewport.pixelReplication=c.pixelReplication,d.viewport.voi.windowWidth<1&&(d.viewport.voi.windowWidth=1),d.viewport.scale<1e-4&&(d.viewport.scale=.25),a.updateImage(b),a.event(d,"CornerstoneViewportUpdated")}function c(b){var c=a.getEnabledElement(b),d=c.viewport;return void 0===d?void 0:{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,pixelReplication:d.pixelReplication}}return void 0===a&&(a={}),a.getViewport=c,a.setViewport=b,a}(cornerstone);